import PerfectScrollbar from 'react-perfect-scrollbar';
import { useTranslation } from 'react-i18next';
import { useDispatch, useSelector } from 'react-redux';
import { NavLink, useLocation } from 'react-router-dom';
import { toggleSidebar } from '../../store/themeConfigSlice';
import AnimateHeight from 'react-animate-height';
import { IRootState } from '../../store';
import { useState, useEffect } from 'react';

const Sidebar = () => {
    const [currentMenu, setCurrentMenu] = useState<string>('');
    const [errorSubMenu, setErrorSubMenu] = useState(false);
    const themeConfig = useSelector((state: IRootState) => state.themeConfig);
    const semidark = useSelector((state: IRootState) => state.themeConfig.semidark);
    const location = useLocation();
    const dispatch = useDispatch();
    const { t } = useTranslation();
    const toggleMenu = (value: string) => {
        setCurrentMenu((oldValue) => {
            return oldValue === value ? '' : value;
        });
    };

    useEffect(() => {
        const selector = document.querySelector('.sidebar ul a[href="' + window.location.pathname + '"]');
        if (selector) {
            selector.classList.add('active');
            const ul: any = selector.closest('ul.sub-menu');
            if (ul) {
                let ele: any = ul.closest('li.menu').querySelectorAll('.nav-link') || [];
                if (ele.length) {
                    ele = ele[0];
                    setTimeout(() => {
                        ele.click();
                    });
                }
            }
        }
    }, []);

    useEffect(() => {
        if (window.innerWidth < 1024 && themeConfig.sidebar) {
            dispatch(toggleSidebar());
        }
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [location]);

    return (
        <div className={semidark ? 'dark' : ''}>
            <nav
                className={`sidebar fixed min-h-screen h-full top-0 bottom-0 w-[260px] shadow-[5px_0_25px_0_rgba(94,92,154,0.1)] z-50 transition-all duration-300 ${semidark ? 'text-white-dark' : ''}`}
            >
                <div className="bg-white dark:bg-black h-full">
                    <div className="flex justify-between items-center px-4 py-3">
                        <NavLink to="/" className="main-logo flex items-center shrink-0">
                            <img className="w-8 ml-[5px] flex-none" src="/assets/images/logo.svg" alt="logo" />
                            <span className="text-2xl ltr:ml-1.5 rtl:mr-1.5 font-semibold align-middle lg:inline dark:text-white-light">{t('VRISTO')}</span>
                        </NavLink>

                        <button
                            type="button"
                            className="collapse-icon w-8 h-8 rounded-full flex items-center hover:bg-gray-500/10 dark:hover:bg-dark-light/10 dark:text-white-light transition duration-300 rtl:rotate-180"
                            onClick={() => dispatch(toggleSidebar())}
                        >
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className="w-5 h-5 m-auto">
                                <path d="M13 19L7 12L13 5" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" />
                                <path opacity="0.5" d="M16.9998 19L10.9998 12L16.9998 5" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" />
                            </svg>
                        </button>
                    </div>
                    <PerfectScrollbar className="h-[calc(100vh-80px)] relative">
                        <ul className="relative font-semibold space-y-0.5 p-4 py-0">
                            <li className="nav-item">
                                <ul>
                                    <li className="nav-item">
                                        <NavLink to="/apps/chat" className="group">
                                            <div className="flex items-center">
                                                <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M12.3134 2.637C12.0977 2.42141 11.8053 2.30029 11.5003 2.30029C11.1954 2.30029 10.9029 2.42141 10.6873 2.637L2.63727 10.687C2.42779 10.9039 2.31188 11.1944 2.3145 11.4959C2.31712 11.7974 2.43806 12.0859 2.65128 12.2991C2.8645 12.5123 3.15293 12.6333 3.45446 12.6359C3.75599 12.6385 4.04648 12.5226 4.26337 12.3131L4.60032 11.9761V19.55C4.60032 19.855 4.72148 20.1476 4.93715 20.3632C5.15282 20.5789 5.44532 20.7 5.75032 20.7H8.05032C8.35532 20.7 8.64783 20.5789 8.86349 20.3632C9.07916 20.1476 9.20032 19.855 9.20032 19.55V17.25C9.20032 16.945 9.32148 16.6525 9.53715 16.4369C9.75282 16.2212 10.0453 16.1 10.3503 16.1H12.6503C12.9553 16.1 13.2478 16.2212 13.4635 16.4369C13.6792 16.6525 13.8003 16.945 13.8003 17.25V19.55C13.8003 19.855 13.9215 20.1476 14.1371 20.3632C14.3528 20.5789 14.6453 20.7 14.9503 20.7H17.2503C17.5553 20.7 17.8478 20.5789 18.0635 20.3632C18.2792 20.1476 18.4003 19.855 18.4003 19.55V11.9761L18.7373 12.3131C18.9542 12.5226 19.2447 12.6385 19.5462 12.6359C19.8477 12.6333 20.1361 12.5123 20.3494 12.2991C20.5626 12.0859 20.6835 11.7974 20.6861 11.4959C20.6888 11.1944 20.5729 10.9039 20.3634 10.687L12.3134 2.637Z"
                                                        fill="#3F3F46"
                                                    />
                                                </svg>

                                                <span className="ltr:pl-3 rtl:pr-3 text-black dark:text-[#506690] dark:group-hover:text-white-dark">{t('Dashboard')}</span>
                                            </div>
                                        </NavLink>
                                    </li>
                                    <li className="nav-item">
                                        <NavLink to="/apps/chat" className="group">
                                            <div className="flex items-center">
                                                <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        fill-rule="evenodd"
                                                        clip-rule="evenodd"
                                                        d="M11.4998 2.2998C11.1948 2.2998 10.9023 2.42097 10.6866 2.63663C10.471 2.8523 10.3498 3.14481 10.3498 3.4498V4.5998C10.3498 4.9048 10.471 5.19731 10.6866 5.41298C10.9023 5.62864 11.1948 5.7498 11.4998 5.7498C11.8048 5.7498 12.0973 5.62864 12.313 5.41298C12.5286 5.19731 12.6498 4.9048 12.6498 4.5998V3.4498C12.6498 3.14481 12.5286 2.8523 12.313 2.63663C12.0973 2.42097 11.8048 2.2998 11.4998 2.2998ZM4.5998 4.5998H8.0498C8.0498 5.5148 8.41329 6.39232 9.06029 7.03932C9.70729 7.68632 10.5848 8.0498 11.4998 8.0498C12.4148 8.0498 13.2923 7.68632 13.9393 7.03932C14.5863 6.39232 14.9498 5.5148 14.9498 4.5998H18.3998C19.0098 4.5998 19.5948 4.84213 20.0261 5.27346C20.4575 5.70479 20.6998 6.28981 20.6998 6.8998V17.2498C20.6998 17.8598 20.4575 18.4448 20.0261 18.8762C19.5948 19.3075 19.0098 19.5498 18.3998 19.5498H4.5998C3.98981 19.5498 3.40479 19.3075 2.97346 18.8762C2.54213 18.4448 2.2998 17.8598 2.2998 17.2498V6.8998C2.2998 6.28981 2.54213 5.70479 2.97346 5.27346C3.40479 4.84213 3.98981 4.5998 4.5998 4.5998ZM7.4748 12.6498C7.9323 12.6498 8.37106 12.4681 8.69456 12.1446C9.01806 11.8211 9.1998 11.3823 9.1998 10.9248C9.1998 10.4673 9.01806 10.0285 8.69456 9.70505C8.37106 9.38155 7.9323 9.1998 7.4748 9.1998C7.01731 9.1998 6.57855 9.38155 6.25505 9.70505C5.93155 10.0285 5.7498 10.4673 5.7498 10.9248C5.7498 11.3823 5.93155 11.8211 6.25505 12.1446C6.57855 12.4681 7.01731 12.6498 7.4748 12.6498ZM10.2923 17.2498C10.3771 16.8323 10.368 16.4011 10.2657 15.9875C10.1634 15.5738 9.97048 15.1881 9.70084 14.8582C9.4312 14.5283 9.0916 14.2625 8.70661 14.0799C8.32163 13.8974 7.90088 13.8027 7.4748 13.8027C7.04873 13.8027 6.62798 13.8974 6.243 14.0799C5.85801 14.2625 5.51841 14.5283 5.24877 14.8582C4.97913 15.1881 4.78618 15.5738 4.68389 15.9875C4.5816 16.4011 4.57252 16.8323 4.6573 17.2498H10.2923ZM13.7998 10.3498C13.4948 10.3498 13.2023 10.471 12.9866 10.6866C12.771 10.9023 12.6498 11.1948 12.6498 11.4998C12.6498 11.8048 12.771 12.0973 12.9866 12.313C13.2023 12.5286 13.4948 12.6498 13.7998 12.6498H17.2498C17.5548 12.6498 17.8473 12.5286 18.063 12.313C18.2786 12.0973 18.3998 11.8048 18.3998 11.4998C18.3998 11.1948 18.2786 10.9023 18.063 10.6866C17.8473 10.471 17.5548 10.3498 17.2498 10.3498H13.7998ZM12.6498 14.9498C12.6498 14.6448 12.771 14.3523 12.9866 14.1366C13.2023 13.921 13.4948 13.7998 13.7998 13.7998H16.0998C16.4048 13.7998 16.6973 13.921 16.913 14.1366C17.1286 14.3523 17.2498 14.6448 17.2498 14.9498C17.2498 15.2548 17.1286 15.5473 16.913 15.763C16.6973 15.9786 16.4048 16.0998 16.0998 16.0998H13.7998C13.4948 16.0998 13.2023 15.9786 12.9866 15.763C12.771 15.5473 12.6498 15.2548 12.6498 14.9498Z"
                                                        fill="#3F3F46"
                                                    />
                                                </svg>

                                                <span className="ltr:pl-3 rtl:pr-3 text-black dark:text-[#506690] dark:group-hover:text-white-dark">{t('Asset Management')}</span>
                                            </div>
                                        </NavLink>
                                    </li>

                                    <li className="nav-item">
                                        <NavLink to="/apps/chat" className="group">
                                            <div className="flex items-center">
                                                <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M10.3502 2.2998C10.0452 2.2998 9.75269 2.42097 9.53702 2.63663C9.32136 2.8523 9.2002 3.14481 9.2002 3.4498C9.2002 3.7548 9.32136 4.04731 9.53702 4.26298C9.75269 4.47864 10.0452 4.5998 10.3502 4.5998H12.6502C12.9552 4.5998 13.2477 4.47864 13.4634 4.26298C13.679 4.04731 13.8002 3.7548 13.8002 3.4498C13.8002 3.14481 13.679 2.8523 13.4634 2.63663C13.2477 2.42097 12.9552 2.2998 12.6502 2.2998H10.3502Z"
                                                        fill="#3F3F46"
                                                    />
                                                    <path
                                                        fill-rule="evenodd"
                                                        clip-rule="evenodd"
                                                        d="M4.59961 5.7502C4.59961 5.1402 4.84193 4.55518 5.27326 4.12385C5.7046 3.69252 6.28961 3.4502 6.89961 3.4502C6.89961 4.36519 7.26309 5.24271 7.91009 5.88971C8.55709 6.53671 9.43461 6.9002 10.3496 6.9002H12.6496C13.5646 6.9002 14.4421 6.53671 15.0891 5.88971C15.7361 5.24271 16.0996 4.36519 16.0996 3.4502C16.7096 3.4502 17.2946 3.69252 17.726 4.12385C18.1573 4.55518 18.3996 5.1402 18.3996 5.7502V18.4002C18.3996 19.0102 18.1573 19.5952 17.726 20.0265C17.2946 20.4579 16.7096 20.7002 16.0996 20.7002H6.89961C6.28961 20.7002 5.7046 20.4579 5.27326 20.0265C4.84193 19.5952 4.59961 19.0102 4.59961 18.4002V5.7502ZM8.04961 10.3502C7.74461 10.3502 7.4521 10.4714 7.23644 10.687C7.02077 10.9027 6.89961 11.1952 6.89961 11.5002C6.89961 11.8052 7.02077 12.0977 7.23644 12.3134C7.4521 12.529 7.74461 12.6502 8.04961 12.6502H8.06111C8.36611 12.6502 8.65862 12.529 8.87428 12.3134C9.08995 12.0977 9.21111 11.8052 9.21111 11.5002C9.21111 11.1952 9.08995 10.9027 8.87428 10.687C8.65862 10.4714 8.36611 10.3502 8.06111 10.3502H8.04961ZM11.4996 10.3502C11.1946 10.3502 10.9021 10.4714 10.6864 10.687C10.4708 10.9027 10.3496 11.1952 10.3496 11.5002C10.3496 11.8052 10.4708 12.0977 10.6864 12.3134C10.9021 12.529 11.1946 12.6502 11.4996 12.6502H14.9496C15.2546 12.6502 15.5471 12.529 15.7628 12.3134C15.9784 12.0977 16.0996 11.8052 16.0996 11.5002C16.0996 11.1952 15.9784 10.9027 15.7628 10.687C15.5471 10.4714 15.2546 10.3502 14.9496 10.3502H11.4996ZM8.04961 14.9502C7.74461 14.9502 7.4521 15.0714 7.23644 15.287C7.02077 15.5027 6.89961 15.7952 6.89961 16.1002C6.89961 16.4052 7.02077 16.6977 7.23644 16.9134C7.4521 17.129 7.74461 17.2502 8.04961 17.2502H8.06111C8.36611 17.2502 8.65862 17.129 8.87428 16.9134C9.08995 16.6977 9.21111 16.4052 9.21111 16.1002C9.21111 15.7952 9.08995 15.5027 8.87428 15.287C8.65862 15.0714 8.36611 14.9502 8.06111 14.9502H8.04961ZM11.4996 14.9502C11.1946 14.9502 10.9021 15.0714 10.6864 15.287C10.4708 15.5027 10.3496 15.7952 10.3496 16.1002C10.3496 16.4052 10.4708 16.6977 10.6864 16.9134C10.9021 17.129 11.1946 17.2502 11.4996 17.2502H14.9496C15.2546 17.2502 15.5471 17.129 15.7628 16.9134C15.9784 16.6977 16.0996 16.4052 16.0996 16.1002C16.0996 15.7952 15.9784 15.5027 15.7628 15.287C15.5471 15.0714 15.2546 14.9502 14.9496 14.9502H11.4996Z"
                                                        fill="#3F3F46"
                                                    />
                                                </svg>

                                                <span className="ltr:pl-3 rtl:pr-3 text-black dark:text-[#506690] dark:group-hover:text-white-dark">{t('Report')}</span>
                                            </div>
                                        </NavLink>
                                    </li>

                                    <li className="menu nav-item">
                                        <button type="button" className={`${currentMenu === 'invoice' ? 'active' : ''} nav-link group w-full`} onClick={() => toggleMenu('invoice')}>
                                            <div className="flex items-center">
                                                <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M14.9504 6.9002C14.9504 7.81519 14.5869 8.69271 13.9399 9.33971C13.2929 9.98671 12.4154 10.3502 11.5004 10.3502C10.5854 10.3502 9.70787 9.98671 9.06087 9.33971C8.41387 8.69271 8.05039 7.81519 8.05039 6.9002C8.05039 5.9852 8.41387 5.10768 9.06087 4.46068C9.70787 3.81368 10.5854 3.4502 11.5004 3.4502C12.4154 3.4502 13.2929 3.81368 13.9399 4.46068C14.5869 5.10768 14.9504 5.9852 14.9504 6.9002ZM20.7004 9.2002C20.7004 9.81019 20.4581 10.3952 20.0267 10.8265C19.5954 11.2579 19.0104 11.5002 18.4004 11.5002C17.7904 11.5002 17.2054 11.2579 16.774 10.8265C16.3427 10.3952 16.1004 9.81019 16.1004 9.2002C16.1004 8.5902 16.3427 8.00518 16.774 7.57385C17.2054 7.14252 17.7904 6.9002 18.4004 6.9002C19.0104 6.9002 19.5954 7.14252 20.0267 7.57385C20.4581 8.00518 20.7004 8.5902 20.7004 9.2002ZM16.1004 17.2502C16.1004 16.0302 15.6158 14.8602 14.7531 13.9975C13.8904 13.1348 12.7204 12.6502 11.5004 12.6502C10.2804 12.6502 9.11037 13.1348 8.2477 13.9975C7.38503 14.8602 6.90039 16.0302 6.90039 17.2502V20.7002H16.1004V17.2502ZM6.90039 9.2002C6.90039 9.81019 6.65807 10.3952 6.22674 10.8265C5.7954 11.2579 5.21039 11.5002 4.60039 11.5002C3.99039 11.5002 3.40538 11.2579 2.97405 10.8265C2.54271 10.3952 2.30039 9.81019 2.30039 9.2002C2.30039 8.5902 2.54271 8.00518 2.97405 7.57385C3.40538 7.14252 3.99039 6.9002 4.60039 6.9002C5.21039 6.9002 5.7954 7.14252 6.22674 7.57385C6.65807 8.00518 6.90039 8.5902 6.90039 9.2002ZM18.4004 20.7002V17.2502C18.4021 16.081 18.1052 14.9307 17.5379 13.9083C18.0477 13.7778 18.5807 13.7655 19.096 13.8723C19.6113 13.9791 20.0954 14.2022 20.5114 14.5246C20.9274 14.847 21.2643 15.2601 21.4963 15.7324C21.7284 16.2048 21.8495 16.7239 21.8504 17.2502V20.7002H18.4004ZM5.46289 13.9083C4.89565 14.9307 4.59878 16.081 4.60039 17.2502V20.7002H1.15039V17.2502C1.15017 16.7235 1.27052 16.2038 1.50223 15.7309C1.73394 15.2579 2.07084 14.8443 2.48713 14.5217C2.90342 14.1991 3.38804 13.9761 3.90385 13.8698C4.41966 13.7635 4.95296 13.7766 5.46289 13.9083Z"
                                                        fill="#3F3F46"
                                                    />
                                                </svg>

                                                <span className="ltr:pl-3 rtl:pr-3 text-black dark:text-[#506690] dark:group-hover:text-white-dark">{t('System Setting')}</span>
                                            </div>

                                            <div className={currentMenu === 'invoice' ? '!rotate-90' : 'rtl:rotate-180'}>
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M9 5L15 12L9 19" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" />
                                                </svg>
                                            </div>
                                        </button>

                                        <AnimateHeight duration={300} height={currentMenu === 'invoice' ? 'auto' : 0}>
                                            <ul className="sub-menu text-gray-500">
                                                <li>
                                                    <NavLink to="/apps/invoice/list">{t('Group & Permission')}</NavLink>
                                                </li>
                                                <li>
                                                    <NavLink to="/apps/invoice/preview">{t('Staff')}</NavLink>
                                                </li>
                                                <li>
                                                    <NavLink to="/apps/invoice/add">{t('Message Setting')}</NavLink>
                                                </li>
                                            </ul>
                                        </AnimateHeight>
                                    </li>

                                    <li className="nav-item">
                                        <NavLink to="/apps/chat" className="group">
                                            <div className="flex items-center">
                                                <svg width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        fill-rule="evenodd"
                                                        clip-rule="evenodd"
                                                        d="M20.6998 11.4998C20.6998 13.9398 19.7305 16.2799 18.0052 18.0052C16.2799 19.7305 13.9398 20.6998 11.4998 20.6998C9.05981 20.6998 6.71976 19.7305 4.99442 18.0052C3.26909 16.2799 2.2998 13.9398 2.2998 11.4998C2.2998 9.05981 3.26909 6.71976 4.99442 4.99442C6.71976 3.26909 9.05981 2.2998 11.4998 2.2998C13.9398 2.2998 16.2799 3.26909 18.0052 4.99442C19.7305 6.71976 20.6998 9.05981 20.6998 11.4998ZM13.7998 8.0498C13.7998 8.6598 13.5575 9.24482 13.1261 9.67615C12.6948 10.1075 12.1098 10.3498 11.4998 10.3498C10.8898 10.3498 10.3048 10.1075 9.87346 9.67615C9.44213 9.24482 9.1998 8.6598 9.1998 8.0498C9.1998 7.43981 9.44213 6.85479 9.87346 6.42346C10.3048 5.99213 10.8898 5.7498 11.4998 5.7498C12.1098 5.7498 12.6948 5.99213 13.1261 6.42346C13.5575 6.85479 13.7998 7.43981 13.7998 8.0498ZM11.4998 12.6498C10.3988 12.6496 9.32087 12.9655 8.39413 13.5599C7.46739 14.1544 6.7308 15.0024 6.2719 16.0032C6.91898 16.756 7.72122 17.3599 8.62359 17.7736C9.52596 18.1873 10.5071 18.4009 11.4998 18.3998C12.4925 18.4009 13.4736 18.1873 14.376 17.7736C15.2784 17.3599 16.0806 16.756 16.7277 16.0032C16.2688 15.0024 15.5322 14.1544 14.6055 13.5599C13.6787 12.9655 12.6008 12.6496 11.4998 12.6498Z"
                                                        fill="#3F3F46"
                                                    />
                                                </svg>

                                                <span className="ltr:pl-3 rtl:pr-3 text-black dark:text-[#506690] dark:group-hover:text-white-dark">{t('Profile')}</span>
                                            </div>
                                        </NavLink>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </PerfectScrollbar>
                </div>
            </nav>
        </div>
    );
};

export default Sidebar;
